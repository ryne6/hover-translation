# PRD: 悬浮框本地语音朗读

## 背景

- 当前悬浮框虽然渲染了“发音”按钮，但点击后只提示“开发中”，无法朗读选中文字。
- 部分用户希望快速听到英语/中文等单词发音，便于记忆与校对。

## 目标

1. **本地朗读**：利用浏览器内置的 Web Speech 合成 API，在无需外部服务的情况下播放选中文字。
2. **交互明确**：播放过程中按钮状态有反馈，结束或失败后自动恢复。
3. **兼容降级**：在不支持语音合成的环境中给出友好提示，不影响其他功能。

## 功能需求

### F1. 发音按钮行为
- 点击悬浮框内的“发音”按钮，读取当前选中文字（原文）。
- 语音语言优先使用后台返回的 `detectedSourceLanguage`，若无则使用 `sourceLang`，再 fallback 到 `en-US`。
- 若正在播报时再次点击，先终止当前发音再重新播放。

### F2. 状态提示
- 播放中，按钮进入高亮（例如添加 `is-speaking` 样式）。
- 播放结束或失败后恢复按钮状态。
- 支持多个快速点击：始终只保留最后一次朗读。

### F3. 失败处理
- 缺少 Web Speech API 时，提示“当前浏览器不支持语音朗读”。
- 找不到可读文本时提示“暂无可朗读的文本”。
- 合成或播放失败时提示错误并输出日志。

## 验收标准

- 在 Chrome/Edge 等支持 Web Speech API 的浏览器中，点击发音按钮可正常朗读选中文字。
- 按钮在播放期间高亮，结束后恢复；重复点击不会导致异常。
- 在不支持 API 的环境（如某些测试或国产浏览器）点击发音按钮会弹出提示，但不会抛出错误。
- 现有自动化测试通过，并新增针对语音按钮的单测。

## Todo List

1. 更新 `HoverBox` 组件：
   - 保存当前翻译数据。
   - 使用 `speechSynthesis` 与 `SpeechSynthesisUtterance` 实现 `playSound`。
   - 新增 `stopSpeaking`、按钮状态切换与错误处理。
   - 在 `hide()` / `destroy()` 时终止播报。
2. 扩展 `hover-box.css`，为发音按钮添加 `is-speaking` 样式。
3. 修改单元测试 (`hover-box.test.js`)：
   - 模拟有/无 `speechSynthesis` 的场景。
   - 验证 `showNotification` 调用与 `speechSynthesis.speak` 被触发。
4. 运行 `npm test`，确保全部通过。
